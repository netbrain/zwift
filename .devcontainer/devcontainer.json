{
    "name": "netbrain-zwift-devcontainer",
    "image": "mcr.microsoft.com/devcontainers/base:debian",
    "features": {
        "ghcr.io/devcontainers/features/docker-in-docker": {
            "version": "latest",
            "installDockerBuildx": true,
            "moby": false
        },
        "ghcr.io/devcontainers/features/nix": {
            "version": "latest",
            "extraNixConfig": "experimental-features = nix-command flakes"
        },
        "ghcr.io/devcontainers-contrib/features/direnv": {
            "version": "latest"
        }
    },
    "customizations": {
        "vscode": {
            "extensions": [
                "DavidAnson.vscode-markdownlint",
                "docker.docker",
                "exiasr.hadolint",
                "foxundermoon.shell-format",
                "jnoortheen.nix-ide",
                "mkhl.direnv",
                "ms-azuretools.vscode-containers",
                "redhat.vscode-yaml",
                "streetsidesoftware.code-spell-checker",
                "timonwong.shellcheck"
            ],
            "settings": {
                "direnv.restart.automatic": true,
                "hadolint": {
                    "cliOptions": [
                        "--config",
                        ".config/.hadolint.yaml"
                    ]
                },
                "markdownlint": {
                    "configFile": ".config/.markdownlint-cli2.jsonc"
                },
                "nix": {
                    "enableLanguageServer": true,
                    "serverPath": "nil",
                    "serverSettings": {
                        "formatting": {
                            "command": [
                                "nixfmt-rfc-style"
                            ]
                        }
                    }
                }
            }
        }
    },
    "postCreateCommand": "direnv allow",
    "postStartCommand": "if ! docker info > /dev/null 2>&1; then sudo update-alternatives --set iptables /usr/sbin/iptables-nft; fi",
    "remoteUser": "vscode"
}
